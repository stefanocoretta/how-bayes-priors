---
title: "How to Bayes: Priors"
author: "Stefano Coretta"
institute: "UoE LEL"
date: "`r Sys.Date()`"
output:
  xaringan::moon_reader:
    lib_dir: libs
    css:
      - default
      - libs/ipa-fonts.css
      - libs/custom.css
    nature:
      highlightStyle: agate
      highlightLanguage: r
      highlightLines: true
      countIncrementalSlides: false
      beforeInit: "libs/macros.js"
      ratio: 16:9
fontsize: 14
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, out.height = "500px", dpi = 300, fig.align = "center", fig.width = 7, fig.height = 5)
knitr::opts_knit$set(root.dir = here::here())
library(tidyverse)
theme_set(theme_light())
library(ggeffects)
library(lme4)
library(brms)
library(tidybayes)
library(bayesplot)
library(extraDistr)
options(htmltools.dir.version = FALSE)
xaringanExtra::use_xaringan_extra(c("panelset", "tachyons"))
```

```{r mald, echo=FALSE}
mald <- readRDS("./data/mald.rds")
```

# Bayesian belief update

<br>

.center[
![:scale 60%](img/prior-update.png)
]

???

How do we ensure that prior knowledge is not lost?

You've seen in the previous sessions that Bayesian analysis is about estimating the posterior probability distribution of a variable of interest.

Roughly speaking, the posterior probability distribution is the combination of the prior belief and the evidence derived from the data.

Prior and evidence are, of course, probability distributions.

---

# Example from last time

[Massive Auditory Lexical Decision](https://aphl.artsrn.ualberta.ca/?page_id=827) (Tucker et al. 2019):

- **MALD data set**: 521 subjects, RTs and accuracy.

- Subset of MALD: 30 subjects, 100 observations each.

--

```{r mald-print}
mald
```


---

# Let's start small

.f2[
What is the probability distribution of RTs, across all conditions?
]

---

# Distribution of RTs

.f2[
$$\text{RT}_i \sim Normal(\mu, \sigma)$$
]

???

This formula tells us that `RT`s are distributed according to (`~`) a Gaussian distribution with mean $\mu$ and standard deviation $\sigma$.

--

<br>
<br>
<br>

Which values do $\mu$ and $\sigma$ have?

--

Pick a $\mu$ and $\sigma$. (OK, but how?)

---

layout: true

# The empirical rule

---

```{r empirical-rule-1, echo=FALSE, fig.width=7, fig.height=4, out.width="800px", fig.retina=2, fig.align="center"}
x <- seq(-4, 4, by = 0.01)
y = dnorm(x, 0, 1)

ger_1 <- ggplot() +
  aes(x, y) +
  geom_line(size = 2, colour = "#FFA70B") +
  scale_x_continuous(breaks = c(-4:4), labels = c("", expression(paste(-3, sigma)), expression(paste(-2, sigma)), expression(paste(-1, sigma)), expression(paste(mu)), expression(paste(+1, sigma)), expression(paste(+2, sigma)), expression(paste(+3, sigma)), "")) +
  ylim(0, 0.6) +
  labs(
    x = element_blank(), y = element_blank()
  )
ger_1
```

---

```{r empirical-rule-2, echo=FALSE, fig.width=7, fig.height=4, out.width="800px", fig.retina=2, fig.align="center"}
ger_1 +
  geom_ribbon(aes(x = ifelse(x >= -1 & x <= 1, x, NA), ymin = 0, ymax = y), alpha = 0.7, fill = "#8970FF") +
  annotate(
    "segment",
    x = -1, xend = 1, y = 0.45, yend = 0.45,
    arrow = arrow(ends = "both", angle = 90, length = unit(.2, "cm")),
    size = 1
  ) +
  annotate("label", x = 0, y = 0.45, label = "68%") +
  geom_line(size = 2, colour = "#FFA70B")
```

---

```{r empirical-rule-3, echo=FALSE, fig.width=7, fig.height=4, out.width="800px", fig.retina=2, fig.align="center"}
ger_1 +
  geom_ribbon(aes(x = ifelse(x >= -2 & x <= 2, x, NA), ymin = 0, ymax = y), alpha = 0.4, fill = "#8970FF") +
annotate(
    "segment",
    x = -2, xend = 2, y = 0.5, yend = 0.5,
    arrow = arrow(ends = "both", angle = 90, length = unit(.2, "cm")),
    size = 1
  ) +
  annotate("label", x = 0, y = 0.50, label = "95%") +
  geom_line(size = 2, colour = "#FFA70B")
```


---

```{r empirical-rule-4, echo=FALSE, fig.width=7, fig.height=4, out.width="800px", fig.retina=2, fig.align="center"}
ger_1 +
  geom_ribbon(aes(x = x, ymin = 0, ymax = y), alpha = 0.3, fill = "#8970FF") +
  annotate(
    "segment",
    x = -3, xend = 3, y = 0.55, yend = 0.55,
    arrow = arrow(ends = "both", angle = 90, length = unit(.2, "cm")),
    size = 1
  ) +
  annotate("label", x = 0, y = 0.55, label = "99.7 ≈ 100%") +
  geom_line(size = 2, colour = "#FFA70B")
```

---

```{r empirical-rule-5, echo=FALSE, fig.width=7, fig.height=4, out.width="800px", fig.retina=2, fig.align="center"}
x <- seq(-4, 4, by = 0.01)
y = dnorm(x, 0, 1)
ggplot() +
  aes(x, y) +
  geom_ribbon(aes(x = x, ymin = 0, ymax = y), alpha = 0.3, fill = "#8970FF") +
  geom_ribbon(aes(x = ifelse(x >= -2 & x <= 2, x, NA), ymin = 0, ymax = y), alpha = 0.4, fill = "#8970FF") +
  geom_ribbon(aes(x = ifelse(x >= -1 & x <= 1, x, NA), ymin = 0, ymax = y), alpha = 0.7, fill = "#8970FF") +
  geom_line(size = 2, colour = "#FFA70B") +
  annotate(
    "segment",
    x = -1, xend = 1, y = 0.45, yend = 0.45,
    arrow = arrow(ends = "both", angle = 90, length = unit(.2, "cm")),
    size = 1
  ) +
  annotate("label", x = 0, y = 0.45, label = "68%") +
  annotate(
    "segment",
    x = -2, xend = 2, y = 0.5, yend = 0.5,
    arrow = arrow(ends = "both", angle = 90, length = unit(.2, "cm")),
    size = 1
  ) +
  annotate("label", x = 0, y = 0.50, label = "95%") +
  annotate(
    "segment",
    x = -3, xend = 3, y = 0.55, yend = 0.55,
    arrow = arrow(ends = "both", angle = 90, length = unit(.2, "cm")),
    size = 1
  ) +
  annotate("label", x = 0, y = 0.55, label = "99.7 ≈ 100%") +
  scale_x_continuous(breaks = c(-4:4), labels = c("", expression(paste(-3, sigma)), expression(paste(-2, sigma)), expression(paste(-1, sigma)), expression(paste(mu)), expression(paste(+1, sigma)), expression(paste(+2, sigma)), expression(paste(+3, sigma)), "")) +
  ylim(0, 0.6) +
  labs(
    x = element_blank(), y = element_blank()
  )
```

???

As a general rule, $\pm2\sigma$ covers 95% of the Gaussian distribution, which means we are 95% confident that the value lies within that range.

---

layout: false

# Distribution of RTs

.f2[
$$\text{RT}_i \sim Normal(\mu, \sigma)$$
]


<br>
<br>
<br>

Pick a $\mu$ and $\sigma$.

Report them here: <https://forms.gle/cqBNtDvZ6NdnpPo79>

---

class: center middle inverse

.f1[Now let's see what we got!]

---

# Distribution of RTs

.f2[
$$\text{RT}_i \sim Normal(\mu, \sigma)$$
$$\mu = ...?$$
]

???

We do have an idea of what the mean RT could be like but we are not certain.

When you are not certain, you make a list of values and their probability, i.e. a probability distribution!

---

# Prior belief as probability distributions

.f2[
$$\text{RT}_i \sim Normal(\mu, \sigma)$$
$$\mu \sim Normal(\mu_1, \sigma_1)$$
]

???

Usually, we assume the mean $\mu$ to be a value taken from another Gaussian distribution (with its own mean and SD).

This Gaussian distribution is the **prior probability distribution** (or simply prior) of the mean.

---

# Prior belief as probability distributions

.f2[
$$\text{RT}_i \sim Normal(\mu, \sigma)$$
$$\mu \sim Normal(\mu_1 = 0, \sigma_1)$$
]

???

We will talk about different types of priors later. For now it's sufficient to remember that a conservative approach (which is what we want to do) is to set $\mu_1$ to 0.

--

<br>
<br>

**What about $\sigma_1$?**

---

# Prior belief as probability distributions

.f2[
$$\text{RT}_i \sim Normal(\mu, \sigma)$$
$$\mu \sim Normal(\mu_1 = 0, \sigma_1)$$
]

???

Let's be generous and assume that the mean RT will definitely not be greater than 3 seconds. (This might seem like a very high number, but we will see how it can help estimation)

$3000/2 = 1500$ ms (remember, two times the SD), so we can set $\sigma_1 = 1500$.


---

# Seeing is believing

```{r mu1-prior, echo=FALSE, fig.width=7, fig.height=4, out.width="800px", fig.retina=2, fig.align="center"}
x <- seq(-6000, 6000)
ggplot() +
  aes(x = x, y = dnorm(x, 0, 1500)) +
  geom_line(size = 2, colour = "#8970FF") +
  labs(
    x = "Mean RT (ms)", y = "Density",
    title = expression(paste("Prior for ", mu)),
    subtitle = expression(paste(mu[1], "=0", ", ", sigma[1], "=1500"))
  )
```

???

Visualising priors is important, because it's easier to grasp their meaning when you can actually see the shape of the distribution.

Are you wondering about the negative values? (RT cannot be negative!) I will tell more about this and how to "fix" it later.

WARNING: The distribution that you see here **is not** the distribution of RTs! It's the prior distribution of the mean of that distribution.

---

# Prior belief as probability distributions

.f2[
$$\text{RT}_i \sim Normal(\mu, \sigma)$$
$$\mu \sim Normal(0, 1500)$$
]

---

# Get the default priors


```{r get-prior}
get_prior(
  RT ~ 1,
  data = mald,
  family = gaussian
)
```

---

# Set your priors

<br>

```{r set-priors, eval=FALSE}
my_priors <- c(
  prior(...), # Intercept
  prior(...)  # sigma
)
```

---

# Set your priors

<br>

```{r set-priors-2, eval=FALSE}
my_priors <- c(
  prior(normal(0, 1500), class = Intercept), # Intercept
  prior(...)  # sigma
)
```

---

# What about $\sigma$?

<br>
<br>

<span style="font-size:1.5em;">$$\text{RT}_i \sim Normal(\mu, \sigma)$$</span>

<span style="font-size:1.5em;">$$\mu \sim Normal(0, 1500)$$</span>

<span style="font-size:1.5em;">$$\sigma = ...?$$</span>

???

Now, what about $\sigma$? (Be careful not to mix up $\sigma$ and $\sigma_1$! This is $\sigma$ from the first line, not $\sigma_1$ from the second line).

---

# Prior for $\sigma$: Half Cauchy

<br>

```{r cauchy, echo=FALSE}
x <- seq(0, 1500, by = 0.1)
y <- dhcauchy(x, sigma = 100)
ggplot() +
  aes(x, y) +
  geom_line(size = 2) +
  labs(
    x = "Articulation rate (syl/s)", y = "Density",
    title = "Half Cauchy distribution",
    subtitle = expression(paste(mu, "=0", ", ", sigma, "=100"))
  )
```

???

```{r hdi-hcauchy}
HDInterval::inverseCDF(
  c(0.5, 0.75, 0.95),
  phcauchy,
  sigma = 100
)
```


---

class: inverse center bottom
background-image: url("img/chris-robert-unsplash.jpg")

# BREAK

---

class: inverse center middle
background-image: url("img/code-matrix.jpg")

# <span style="font-size:1.5em;">LIVE CODING</span>
